<div class="container-fluid min-vh-100 p-0 m-0" *ngIf="!isLoading && item; else loadingTemplate">
  <div class="container">
    
  </div>
  <mat-card class="item-card shadow-sm border-0 p-4">

    <div class="row g-4 p-4">

      <!-- Image & Feedback Section -->
      <div class="col-lg-5">
        <div class="position-relative mb-4">
          <img [src]="item.imageUrl || fallbackImage"
               [alt]="item.name"
               class="img-fluid rounded w-100"
               style="max-height: 300px; object-fit: cover; border: 1px solid #e0e0e0;"
               (error)="handleImageError($event)" />

          <!-- Discount Badge -->
          <div class="badge bg-danger position-absolute top-0 start-0 m-3 px-3 py-2"
               *ngIf="item.discountPrice && calculateDiscount(item) > 0">
            <span class="fw-bold">{{ calculateDiscount(item) }}% OFF</span>
          </div>
        </div>

        <!-- Actions -->
        <div class="d-flex flex-wrap gap-2 mb-4">
          <button mat-stroked-button class="flex-fill text-black" (click)="addToCart(item)">
            <mat-icon class="me-2">add_shopping_cart</mat-icon> Add to Cart
          </button>
          <button mat-stroked-button  class="flex-fill text-success" (click)="buyNow(item)">
            <mat-icon class="me-2">flash_on</mat-icon> Buy Now
          </button>
            <button mat-stroked-button color="primary" class="px-4 py-2 mt-2 mt-lg-0" (click)="goBack()">
            <mat-icon class="me-2">arrow_back</mat-icon> Back
          </button>
        </div>

        <!-- Feedback Section -->
        <div>
          <h4 class="fw-bold mb-3">Customer Feedback</h4>
          <mat-divider class="mb-4"></mat-divider>

          <mat-form-field appearance="outline" class="w-100 mb-3">
            <mat-label>Your Feedback</mat-label>
            <textarea matInput [(ngModel)]="feedbackText" rows="4" placeholder="Share your experience..."></textarea>
          </mat-form-field>

          <div class="d-flex align-items-center gap-3 mb-4 flex-wrap">
            <mat-form-field appearance="outline" class="w-auto">
              <mat-label>Rating</mat-label>
              <mat-select [(ngModel)]="feedbackRating">
                <mat-option *ngFor="let r of [1,2,3,4,5]" [value]="r">
                  {{ r }} Star{{ r > 1 ? 's' : '' }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <button mat-flat-button color="primary" (click)="submitFeedback()">Submit Feedback</button>
          </div>

          <div *ngIf="feedbacks.length > 0">
            <h5 class="fw-bold mb-3">Previous Feedback</h5>
            <div *ngFor="let f of feedbacks" class="border rounded p-3 mb-3 bg-light">
              <div class="d-flex align-items-center mb-2 flex-wrap">
                <strong class="me-2">{{ f.user || 'Anonymous' }}</strong>
                <span class="text-warning">{{ '★'.repeat(f.rating) }}{{ '☆'.repeat(5 - f.rating) }}</span>
              </div>
              <p class="mb-0">{{ f.comment }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Details Section -->
      <div class="col-lg-7 d-flex flex-column">
        <div class="d-flex justify-content-between align-items-start mb-3 flex-wrap">
          <h1 class="fw-bold text-dark mb-2" style="font-size: 2rem;">{{ item.name }}</h1>
        </div>

        <h6 class="text-muted mb-3">{{ item.category }}</h6>

        <div class="d-flex align-items-center gap-3 mb-3 flex-wrap">
          <span class="h3 text-primary fw-bold">₹{{ item.discountPrice | number:'1.2-2' }}</span>
          <span *ngIf="item.price && item.discountPrice" class="text-muted text-decoration-line-through fs-5">
            ₹{{ item.price | number:'1.2-2' }}
          </span>
        </div>

        <p class="text-muted mb-2"><strong>Quantity:</strong> {{ item.quantity }} {{ item.quantityUnit }}</p>
        <p class="text-muted mb-2"><strong>Shop:</strong> {{ item.shopName }}</p>
        <p class="text-muted mb-2"><strong>Details:</strong> {{ item.details || 'No details available' }}</p>
        <p class="text-muted mb-4"><strong>Additional Details:</strong> {{ item.additionalDetails || 'No additional details' }}</p>

      </div>
    </div>
  </mat-card>
</div>

<ng-template #loadingTemplate>
  <div class="d-flex flex-column align-items-center justify-content-center min-vh-100">
    <mat-spinner diameter="60" color="primary"></mat-spinner>
    <p class="mt-3 text-muted fs-5">Loading item details...</p>
  </div>
</ng-template>

<!-- Related / Other Items Section -->
<div class="container-fluid py-4">
  <app-items></app-items>
</div>
