<div class="container-fluid ">
  <div class="row g-3 p-4">
    <div class="col-sm-6 col-md-4 col-lg-3" *ngFor="let item of items">
      <mat-card class="h-100 shadow-sm d-flex flex-column">

        <!-- Image -->
        <div class="card-image-wrapper">
          <img mat-card-image
            [src]="item.imageUrl || 'https://rkmrajahmundry.org/wp-content/uploads/2020/04/default-placeholder.png'"
            [alt]="'Image of ' + item.name" class="img-fluid rounded" (click)="viewDetails(item.id)">
        </div>

        <!-- Name -->
        <mat-card-header>
          <mat-card-title class="text-truncate">{{ item.name }}</mat-card-title>
        </mat-card-header>

        <!-- Details + Price -->
        <mat-card-content class="flex-grow-1">
          <p class="text-muted small text-truncate" [title]="item.details">{{ item.details }}</p>

          <div class="d-flex align-items-center gap-2 flex-wrap mt-2">
            <span class="fw-bold text-success">₹{{ item.discountPrice }}</span>
            <span *ngIf="item.price && item.discountPrice" class="text-danger small">
              ({{ calculateDiscount(item) }}% off)
            </span>
            <span *ngIf="item.price" class="text-decoration-line-through text-muted small">₹{{ item.price }}</span>
          </div>
        </mat-card-content>

        <!-- Actions: Cart + Quantity + Buy Now -->
        <mat-card-actions class="d-flex justify-content-between align-items-center mt-auto">
          <div class="d-flex align-items-center gap-1">
            <button mat-icon-button color="primary" (click)="addToCart(item)" aria-label="Add item to cart">
              <mat-icon>add_shopping_cart</mat-icon>
            </button>

            <div *ngIf="getItemQuantity(item.id) > 0"
              class="d-flex align-items-center border rounded px-2 gap-1 bg-light">
              <button mat-icon-button color="primary" (click)="decreaseQuantity(item)">
                <mat-icon>remove</mat-icon>
              </button>
              <span class="px-1">{{ getItemQuantity(item.id) }}</span>
              <button mat-icon-button color="primary" (click)="increaseQuantity(item)">
                <mat-icon>add</mat-icon>
              </button>
            </div>
          </div>

          <button mat-stroked-button class="text-success" (click)="buyNow(item)">
            <mat-icon>flash_on</mat-icon> Buy Now
          </button>
        </mat-card-actions>

      </mat-card>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="items.length === 0" class="alert alert-info mt-4 text-center">
    No items available.
  </div>
</div>